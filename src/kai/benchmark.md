# Benchmark results

## Savina

Still need to check the file generated and original Pat file VISUALLY.

Still need to check if they run in Erlang.

Still need to test with Dialyzer.


| File Name        | Erlang run | Mailboxer compile                                                                                                                | Pat run                                                                                                                                                                                                                                                                             | Limitations                                                                                                                                      |
| ------------------ | :----------: | ---------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- |
| ! banking        |     NO     | 1. Yes<br/> 2. Codes after `free` problem                                                                                        | 1.`let _49 = generate_work6(mb1245, num_accounts8, account110, account219,  account328) in let (x47, mb1348) = _49 in free(mb1348)` [PRETYPE] Type mismatch. Expected a pair type but got Unit. (I guess it's related the " Codes after free problem"). Stuck because of branching. |                                                                                                                                                  |
| ! big            |     NO     | 1. Codes after`free` problem<br/> 2. Receive code only include `free`<br/> 3.`pat_syntax:let_expr error`</br> Multiple mailboxes | Stuck because of branching.                                                                                                                                                                                                                                                   |                                                                                                                                                  |
| cig_smok         |    Yes    | Yes                                                                                                                              | Yes                                                                                                                                                                                                                                                                                 | 1. Needs manual flushing of the mailbox<br/> 2. Server function had to be split into init and loop                                               |
| count            |    Yes    | Yes                                                                                                                              | Yes                                                                                                                                                                                                                                                                                 | 1. Server function had to be split into init and loop                                                                                            |
| fib              |    Yes    | Yes                                                                                                                              | Yes                                                                                                                                                                                                                                                                                 |                                                                                                                                                  |
| fib_pairs        |    Yes    | Yes                                                                                                                              | Yes                                                                                                                                                                                                                                                                                 |                                                                                                                                                  |
| kfork            |    Yes    | Yes                                                                                                                              | Yes                                                                                                                                                                                                                                                                                 | 1. Server function had to be split into init and loop                                                                                            |
| ! log_map        | Yes kinda | Yes                                                                                                                              | Stuck because of branching.                                                                                                                                                                                                                                                         |                                                                                                                                                  |
| philosopher      |    Yes    | Yes                                                                                                                              | Yes                                                                                                                                                                                                                                                                                 | 1. Needs manual flushing of the mailbox<br/> 2. Server function had to be split into init and loop</br> 3. Cannot fully express because of lists |
| ping_pong        |    Yes    | Yes                                                                                                                              | Yes                                                                                                                                                                                                                                                                                 | 1. Needs manual flushing of the mailbox<br/> 2. Server function had to be split into init and loop                                               |
| ping_pong_strict |    Yes    | Yes                                                                                                                              | Yes                                                                                                                                                                                                                                                                                 | 1. Needs manual flushing of the mailbox<br/> 2. Server function had to be split into init and loop                                               |
| thread_ring      |    Yes    | Yes                                                                                                                              | Yes                                                                                                                                                                                                                                                                                 | 1. Needs manual flushing of the mailbox                                                                                                          |

## De_Liguoro_Padovani


| File Name        | Erlang run | Mailboxer compile                                                                                                                                                                                                                                            | Pat run | Limitations                                                                                        |
| ------------------ | :----------: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | ---------------------------------------------------------------------------------------------------- |
| ! account        |     NO     | NO. Requires multiple mailboxes. Confirmed with Simon.                                                                                                                                                                                                       | No      |                                                                                                    |
| ! account_future |    Yes    | No. Requires multiple mailboxes. Confirmed with Simon.                                                                                                                                                                                                       |         |                                                                                                    |
| future           |    Yes    | Yes                                                                                                                                                                                                                                                          | Yes     |                                                                                                    |
| ! lock           |    Yes    | 1.`fail(self)[Unit] problem`<br/>2. Interface like `Release(Unit)` problem<br/> 3. Two functions use same mailbox problem. Duncan: Cannot be done before resolving the issue where a mailbox markes as 'use' can be spawned using 'new' implicitly. Point 3. |         |                                                                                                    |
| master_worker    |     No     | Yes                                                                                                                                                                                                                                                          | Yes     | 1. Needs manual flushing of the mailbox<br/> 2. Server function had to be split into init and loop |
| sessions         |    Yes    | Yes                                                                                                                                                                                                                                                          | Yes     |                                                                                                    |

## Other


| File Name   |     Erlang run     | Mailboxer compile                        | Pat run                                                                                                        |
| ------------- | :-------------------: | ------------------------------------------ | ---------------------------------------------------------------------------------------------------------------- |
| interfaces  |         No         | 1. Multiple mailbox bind to main problem |                                                                                                                |
| pat_constrs |         Yes         | Yes                                      | 1. Receive code only include`free`<br/> 2. `[CONSTRAINT SOLVING] Pattern variable p10 was solved as pattern 0` |
| products    |         No         | 1. Can't send message first before spawn |                                                                                                                |
| robotsn     | No idea about`main` | 1. Receive code only include`free`       |                                                                                                                |

# PAT error notes

* When Pat produces the error `(*(Result) + 1) is not included in 1` it means that our code is expected to receive `Result` messages but somewhere there is a missing `receive` statement that dequeues the mailbox of `*Result`.
  As a result, these `Result` messages are not consumed.
  Pat is expecting the mailbox to be empty but it is not inferring this from the code.
  Pat reports this by the error `The expected XXX message is not included in 1`, where `1` is the empty mailbox.
  The starting erroneous point in the code is `(*(Result) + 1)`, which we need to bring to `1` by balancing out the mailbox.
  To resolve this, we need to add a `receive` expression that consumes all `Result` messages.
  One common way where this arises is in branching statement, where in one branch we receive, but in the other branch we do not.
  To fix this, we need to drain the mailbox of `Result` messages in the branch that has the missing `receive` expression.
  Missing message receive: **Expecting an empty mailbox but inferred a missing message receive that consumes the message pattern '~s'**.

For missing sends: **Inferred an empty mailbox but expecting a missing message send that produces the message pattern '~s'**
